{% extends 'base.html' %}
{% block title %}Документ — ЭДО{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header bg-primary text-white"><h5 class="mb-0">{{ doc.title }}</h5></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6"><strong>Тип документа:</strong> {{ doc.type_choices|default:"—" }}</div>
      <div class="col-md-6"><strong>Статус:</strong> <span class="badge bg-secondary">{{ doc.get_status_display }}</span></div>
      <div class="col-md-6"><strong>Создатель:</strong> {{ doc.creator.get_full_name|default:doc.creator.username }}</div>
      <div class="col-md-6"><strong>Согласующий:</strong> {{ doc.executor.get_full_name|default:doc.executor.username }}</div>
      <div class="col-md-6"><strong>Дата создания:</strong> {{ doc.created_at|date:"d.m.Y H:i" }}</div>
      <div class="col-12"><strong>Комментарий:</strong> {{ doc.reviewer_comment|default:"—" }}</div>
      {% if doc.file %}
      <div class="col-12"><strong>Файл:</strong> <a href="{{ doc.file.url }}" class="btn btn-sm btn-outline-primary" target="_blank" download>Скачать</a></div>
      {% endif %}
    </div>

    <hr>
    <h5 class="mb-3">История маршрута документа</h5>
    {% if doc.action_logs.all %}
      <ul class="list-group">
        {% for log in doc.action_logs.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div><strong>{{ log.user.get_full_name|default:log.user.username }}</strong> — {{ log.get_action_display }}</div>
            <small class="text-muted">{{ log.timestamp|date:"d.m.Y H:i" }}</small>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted mb-0">История действий отсутствует.</p>
    {% endif %}
  </div>
  <div class="card-footer text-end">
    <a href="{% url 'archive' %}" class="btn btn-outline-secondary">Назад</a>
  </div>
</div>
{% endblock %}
